#lang racket
;; Seashell - a C Development Environment.
;; Copyright (C) 2013 The Seashell Maintainers.
;;
;; This program is free software: you can redistribute it and/or modify
;; it under the terms of the GNU General Public License as published by
;; the Free Software Foundation, either version 3 of the License, or
;; (at your option) any later version.
;;
;; See also 'ADDITIONAL TERMS' at the end of the included LICENSE file.
;;
;; This program is distributed in the hope that it will be useful,
;; but WITHOUT ANY WARRANTY; without even the implied warranty of
;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
;; GNU General Public License for more details.
;;
;; You should have received a copy of the GNU General Public License
;; along with this program.  If not, see <http://www.gnu.org/licenses/>.
(provide read-config)

;; (seashell-declare-config read-config (key value) ...)
;; This macro binds a procedure (read-config part) -> any/c
;; with the following contract:
;;
;; Arguments:
;;  part - Part of configuration data to read.
;; Returns:
;;  Configuration data.

(define-syntax seashell-declare-config
  (syntax-rules ()
    [(_  read-config (k v) ...)
     (define/contract (read-config part)
         (-> symbol? any/c)
         (match part
                ['k v] ...
                [else 'undefined]))]))

;; Seashell configuration follows.

;; These constants are used to build several configuration values.
(define seashell-install-path
  "@CMAKE_INSTALL_PREFIX@")

(define seashell-numeric-debug
  @SEASHELL_DEBUG@)

(seashell-declare-config read-config

  ;; Enable debug mode execution (corresponds to seashell-numeric-debug value by default)
  [debug                         (= seashell-numeric-debug 1)]

  ;; Backend target host. The gateway will attempt to start user sessions on this host
  ;; via SSH.
  [host                          "localhost"]

  ;; Location of per-user configuration directory.
  [seashell                      (build-path (find-system-path 'home-dir) ".seashell")]

  ;; Location of install path.
  [seashell-install              (build-path seashell-install-path)]

  ;; Location of SSH tunnel binary.
  [tunnel-binary                 (build-path seashell-install-path "bin" "seashell-tunnel")]

  ;; Location of Seashell crypto library.
  [seashell-crypto               (build-path seashell-install-path "lib" "libseashell-crypto")]

  ;; Location of Seashell clang library.
  [seashell-clang                (build-path seashell-install-path "lib" "libseashell-clang")]

  ;; Location of Seashell git library.
  [seashell-git                  (build-path seashell-install-path "lib" "libseashell-git")]

  ;; Location of Seashell collects.
  [seashell-collects             (build-path seashell-install-path "share" "collects")]

  ;; Timeout in milliseconds after which a per-user backend process, having
  ;; received no new messages, will terminate.
  [backend-client-idle-timeout   1800000]

  ;; Timeout in milliseconds after which a per-user backend connection,
  ;; having received no new messages, will quit.
  [backend-client-connection-timeout 900000]

  ;; Timeout in seconds after which an in-progress gateway login will be killed.
  [backend-login-timeout         30]

  ;; Default binary to invoke when linking.
  [system-linker                 "/usr/bin/cc"]

  ;; Prefix on linker flags.
  [linker-flag-prefix            "-Wl,"]
)

;; Configuration for the Racket interpreter
(compile-context-preservation-enabled (read-config 'debug))
